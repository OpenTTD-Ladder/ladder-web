/*!
 * mustache.js - Logic-less {{mustache}} templates with JavaScript
 * http://github.com/janl/mustache.js
 *//*global define: false*/(function(a,b){typeof exports=="object"&&exports?module.exports=b:typeof define=="function"&&define.amd?define(b):a.Mustache=b})(this,function(){function j(a,b){return h.call(a,b)}function k(a){return!j(d,a)}function m(a){return a.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function o(a){return String(a).replace(/[&<>"'\/]/g,function(a){return n[a]})}function p(a){this.string=a,this.tail=a,this.pos=0}function q(a,b){this.view=a,this.parent=b,this._cache={}}function r(){this.clearCache()}function s(b,c,d,e){var f="",g,h,i;for(var j=0,k=b.length;j<k;++j){g=b[j],h=g[1];switch(g[0]){case"#":i=d.lookup(h);if(typeof i=="object")if(l(i))for(var m=0,n=i.length;m<n;++m)f+=s(g[4],c,d.push(i[m]),e);else i&&(f+=s(g[4],c,d.push(i),e));else if(typeof i=="function"){var o=e==null?null:e.slice(g[3],g[5]);i=i.call(d.view,o,function(a){return c.render(a,d)}),i!=null&&(f+=i)}else i&&(f+=s(g[4],c,d,e));break;case"^":i=d.lookup(h);if(!i||l(i)&&i.length===0)f+=s(g[4],c,d,e);break;case">":i=c.getPartial(h),typeof i=="function"&&(f+=i(d));break;case"&":i=d.lookup(h),i!=null&&(f+=i);break;case"name":i=d.lookup(h),i!=null&&(f+=a.escape(i));break;case"text":f+=h}}return f}function t(a){var b=[],c=b,d=[],e;for(var f=0,g=a.length;f<g;++f){e=a[f];switch(e[0]){case"#":case"^":d.push(e),c.push(e),c=e[4]=[];break;case"/":var h=d.pop();h[5]=e[2],c=d.length>0?d[d.length-1][4]:b;break;default:c.push(e)}}return b}function u(a){var b=[],c,d;for(var e=0,f=a.length;e<f;++e)c=a[e],c&&(c[0]==="text"&&d&&d[0]==="text"?(d[1]+=c[1],d[3]=c[3]):(d=c,b.push(c)));return b}function v(a){return[new RegExp(m(a[0])+"\\s*"),new RegExp("\\s*"+m(a[1]))]}var a={};a.name="mustache.js",a.version="0.7.2",a.tags=["{{","}}"],a.Scanner=p,a.Context=q,a.Writer=r;var b=/\s*/,c=/\s+/,d=/\S/,e=/\s*=/,f=/\s*\}/,g=/#|\^|\/|>|\{|&|=|!/,h=RegExp.prototype.test,i=Object.prototype.toString,l=Array.isArray||function(a){return i.call(a)==="[object Array]"},n={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};a.escape=o,p.prototype.eos=function(){return this.tail===""},p.prototype.scan=function(a){var b=this.tail.match(a);return b&&b.index===0?(this.tail=this.tail.substring(b[0].length),this.pos+=b[0].length,b[0]):""},p.prototype.scanUntil=function(a){var b,c=this.tail.search(a);switch(c){case-1:b=this.tail,this.pos+=this.tail.length,this.tail="";break;case 0:b="";break;default:b=this.tail.substring(0,c),this.tail=this.tail.substring(c),this.pos+=c}return b},q.make=function(a){return a instanceof q?a:new q(a)},q.prototype.push=function(a){return new q(a,this)},q.prototype.lookup=function(a){var b=this._cache[a];if(!b){if(a==".")b=this.view;else{var c=this;while(c){if(a.indexOf(".")>0){b=c.view;var d=a.split("."),e=0;while(b&&e<d.length)b=b[d[e++]]}else b=c.view[a];if(b!=null)break;c=c.parent}}this._cache[a]=b}return typeof b=="function"&&(b=b.call(this.view)),b},r.prototype.clearCache=function(){this._cache={},this._partialCache={}},r.prototype.compile=function(b,c){var d=this._cache[b];if(!d){var e=a.parse(b,c);d=this._cache[b]=this.compileTokens(e,b)}return d},r.prototype.compilePartial=function(a,b,c){var d=this.compile(b,c);return this._partialCache[a]=d,d},r.prototype.getPartial=function(a){return!(a in this._partialCache)&&this._loadPartial&&this.compilePartial(a,this._loadPartial(a)),this._partialCache[a]},r.prototype.compileTokens=function(a,b){var c=this;return function(d,e){if(e)if(typeof e=="function")c._loadPartial=e;else for(var f in e)c.compilePartial(f,e[f]);return s(a,c,q.make(d),b)}},r.prototype.render=function(a,b,c){return this.compile(a)(b,c)},a.parse=function(d,h){function s(){if(q&&!r)while(o.length)delete n[o.pop()];else o=[];q=!1,r=!1}d=d||"",h=h||a.tags,typeof h=="string"&&(h=h.split(c));if(h.length!==2)throw new Error("Invalid tags: "+h.join(", "));var i=v(h),j=new p(d),l=[],n=[],o=[],q=!1,r=!1,w,x,y,z,A;while(!j.eos()){w=j.pos,y=j.scanUntil(i[0]);if(y)for(var B=0,C=y.length;B<C;++B)z=y.charAt(B),k(z)?o.push(n.length):r=!0,n.push(["text",z,w,w+1]),w+=1,z=="\n"&&s();if(!j.scan(i[0]))break;q=!0,x=j.scan(g)||"name",j.scan(b),x==="="?(y=j.scanUntil(e),j.scan(e),j.scanUntil(i[1])):x==="{"?(y=j.scanUntil(new RegExp("\\s*"+m("}"+h[1]))),j.scan(f),j.scanUntil(i[1]),x="&"):y=j.scanUntil(i[1]);if(!j.scan(i[1]))throw new Error("Unclosed tag at "+j.pos);A=[x,y,w,j.pos],n.push(A);if(x==="#"||x==="^")l.push(A);else if(x==="/"){if(l.length===0)throw new Error('Unopened section "'+y+'" at '+w);var D=l.pop();if(D[1]!==y)throw new Error('Unclosed section "'+D[1]+'" at '+w)}else if(x==="name"||x==="{"||x==="&")r=!0;else if(x==="="){h=y.split(c);if(h.length!==2)throw new Error("Invalid tags at "+w+": "+h.join(", "));i=v(h)}}var D=l.pop();if(D)throw new Error('Unclosed section "'+D[1]+'" at '+j.pos);return n=u(n),t(n)};var w=new r;return a.clearCache=function(){return w.clearCache()},a.compile=function(a,b){return w.compile(a,b)},a.compilePartial=function(a,b,c){return w.compilePartial(a,b,c)},a.compileTokens=function(a,b){return w.compileTokens(a,b)},a.render=function(a,b,c){return w.render(a,b,c)},a.to_html=function(b,c,d,e){var f=a.render(b,c,d);if(typeof e!="function")return f;e(f)},a}());